<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>

  .fa{
    padding: 0 4px;
    cursor: pointer;
  }
  .fa-close{
    color: red;
  }
  .tdo{
    width: 150px;
    padding: 4px;
    display: inline-block;
    border-bottom: solid 0.5px lightgrey;
  }
  .stout{
    text-decoration: line-through;
  }
</style>
</head>
<body>

  <div>
    <div id="todos">
    </div>
  </div>

</body>
<script>

(function(){
    let todos = [];


    function changeStatus(id,status){
      //todos.filter(i=>{i.status = (i.id==id ? status : i.status);});
      todos.forEach((i,ind)=>{console.log(ind);i.status = (i.id==id ? status : i.status);});
      saveTodo();
      return
    }

    function deleteTodo(evt){
      const e =  evt.currentTarget
      let pId = e.getAttribute('data-id');

      todos = todos.filter(i=>{return i.id != pId});
      saveTodo();
      console.log(todos);
      e.parentNode.parentNode.removeChild(e.parentNode);
    }

    function switchCheck(evt){
      const e =  evt.target
      let pId = e.getAttribute('data-id');
      let elm = document.getElementById(`d${pId}`);
      let elmTodo = e.parentNode.getElementsByClassName("tdo")[0];
      console.log(elmTodo);
      if(elmTodo.classList.contains("stout")){
        elmTodo.classList.remove("stout");
      }else{
        elmTodo.classList.add("stout");
      }
      changeStatus(pId,e.checked);
    }


    let singleCardNew = (obj) => {
      let ndiv = document.createElement('div');
      ndiv.style.padding =  `10px`;
      ndiv.style.verticalAlign =  `super`;

      let checkBox = document.createElement('input');
      checkBox.setAttribute('id',`d${obj.id}`);
      checkBox.setAttribute('data-id',obj.id);
      checkBox.setAttribute('type',`checkbox`);
      checkBox.onchange = switchCheck.bind(checkBox);
      if(obj.status)checkBox.checked = true;
      ndiv.appendChild(checkBox);

      var aSpan = document.createElement('span');
      aSpan.className = (`tdo${(obj.status?' stout':'')}`);
      aSpan.textContent = obj.todo
      ndiv.appendChild(aSpan);

      let aDelete = document.createElement('a');
      aDelete.onclick = deleteTodo.bind(aDelete);
      aDelete.setAttribute('id',`de${obj.id}`);
      aDelete.setAttribute('data-action','delete');
      aDelete.setAttribute('data-id',obj.id);
      aDelete.innerHTML = `<i class="fa fa-close"></i>`;
      ndiv.appendChild(aDelete);

      ndiv.appendChild(document.createElement('br'));

      return ndiv
    }



    function updateUI(node,p){
      p++;
      let uihtml = "";
      let ui = document.createElement('div');
      ui.style.margin = `5px ${30}px`;

      let inBox = document.createElement('input');
      inBox.setAttribute('id',`todoinput`);
      inBox.style.marginLeft = `25px`;
      ui.appendChild(inBox);

      let infa = document.createElement('i');
      infa.className = "fa fa-plus";
      infa.onclick = addTodo.bind(infa);
      ui.appendChild(infa);


      for(let i of node){
        ui.append(singleCardNew(i));
      }

      return ui;
    }

    function addTodo(){
      todos.push({
          'todo' : document.getElementById(`todoinput`).value,
          'id' : (new Date()).getTime().toString().substr(0, 13),
          'status' : 0
        })
      saveTodo();
      document.getElementById('todos').innerHTML = ""
      document.getElementById('todos').append(updateUI(todos,0));
      return
    }

    function saveTodo(){
      localStorage.setItem("todo",JSON.stringify(todos));
    }

    function loadJson(){
      return new Promise((resolve)=>{
        let lStore = localStorage.getItem("todo");
        if(lStore){
          todos = JSON.parse(lStore);
          resolve()
        }else{
          fetch("https://sonukedia55.github.io/others/todoresponse.txt").then(res=>{
            res.json().then(val=>{
              console.log(val);
              todos = val;
              saveTodo();
              resolve()
            })
          })
        }
      });
    }

    loadJson().then(()=>{
      document.getElementById('todos').innerHTML = ""
      document.getElementById('todos').append(updateUI(todos,0));
    })

}())


</script>

</html>
